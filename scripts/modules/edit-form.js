var G=".body";var F="#message";var $=".element",R="element--active";var x=".element__contacts",H="element__contacts--open",k=".element__counter",q="element__counter--active",K=".element__message",y=".column__element",T=".message",C=".message__name",d=".message__position",f=".message__phone",D=".contact-table",b=".js-delete-contact-button",h=".js-edit-contact-button";var Y="#edit-popup-content",j="#popup-name",J="#popup-position",W="#popup-phone",z=".popup__error",Z=".modal",Q=".modal__title",X=".modal__body";var N=class{constructor(o,e){this.counterElement=o,this.contactsContainer=e,this.count=0}increase(){this.count++,this.update()}decrease(){this.count>0&&(this.count--,this.update())}reset(){this.count=0,this.update()}update(){let o=this.contactsContainer.parentElement;o&&(this.count>0?(this.counterElement.classList.add(q),o.classList.add(R)):(this.counterElement.classList.remove(q),o.classList.remove(R))),this.counterElement.textContent=this.count.toString()}};function tt(t){if(localStorage.getItem(t))try{let e=localStorage.getItem(t);return e?JSON.parse(e):[]}catch(e){throw console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage:",e),new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage")}return[]}function w(t,o){localStorage.setItem(t,JSON.stringify(o))}var U="contacts",_=tt(U);function A(){return _}function et({name:t,position:o,phone:e}){_=_.filter(n=>n.name!==t||n.position!==o||n.phone!==e),w(U,_)}function ot(t,o){_=_.map(e=>e.name===t.name&&e.position===t.position&&e.phone===t.phone?o:e),w(U,_)}var P={};function dt({name:t,position:o,phone:e}){let r=document.querySelector(F).content.querySelector(T)?.cloneNode(!0);if(!r)return;let s=r.querySelector(C),a=r.querySelector(d),l=r.querySelector(f);return!s||!a||!l?null:(s.textContent=t,a.textContent=o,l.textContent=e,r)}function ft(t,o){o.innerHTML="",t.forEach(({name:e,position:n,phone:c})=>{let r=dt({name:e,position:n,phone:c});r&&o.append(r)})}function _t(t,o){let e=document.querySelector(`[data-id="${t.toLowerCase()}"]`)?.closest(y);if(e){let n=e.querySelector(x);ft(o,n);let c=e.querySelector(k);P[t]||(P[t]=new N(c,n)),P[t].count=o.length,P[t].update()}}function nt(t){let e=t.target.closest(T);if(!e)return;let n=e.querySelector(C)?.textContent??"",c=e.querySelector(d)?.textContent??"",r=e.querySelector(f)?.textContent??"";et({name:n,position:c,phone:r}),e.remove();let s=n[0].toUpperCase(),a=A().filter(l=>l.name[0].toUpperCase()===s);_t(s,a)}function rt(t,o){let e=t.name[0].toUpperCase(),n=document.querySelector(`[data-id="${e.toLowerCase()}"]`)?.closest(y);n&&n.querySelector(x).querySelectorAll(K).forEach(s=>{let a=s.querySelector(C)?.textContent??"",l=s.querySelector(d)?.textContent??"",L=s.querySelector(f)?.textContent??"";if(a===t.name&&l===t.position&&L===t.phone){let p=s.querySelector(C),E=s.querySelector(d),M=s.querySelector(f);p&&E&&M&&(p.textContent=o.name,E.textContent=o.position,M.textContent=o.phone)}})}function st(t){let o=t.target;if(o.closest(y)){let e=o.closest($);if(!e)return;let n=e.querySelector(x);if(!n)return;n.classList.toggle(H),n.classList.contains(H)?n.style.maxHeight=`${n.scrollHeight}px`:n.style.maxHeight="0"}}document.querySelector(D)?.addEventListener("click",t=>{let o=t.target;if(o.closest(b)){nt(t);return}if(o.closest(h)){let e=o.closest(T),n=e.querySelector(C)?.textContent??"",c=e.querySelector(d)?.textContent??"",r=e.querySelector(f)?.textContent??"";V({name:n,position:c,phone:r})}st(t)});document.querySelector(D)?.addEventListener("keydown",t=>{let o=t;if(o.key===" "||o.key==="Enter"){t.preventDefault();let e=t.target;if(e.matches(b)){nt(t);return}if(e.closest(h)){let n=e.closest(T),c=n.querySelector(C)?.textContent??"",r=n.querySelector(d)?.textContent??"",s=n.querySelector(f)?.textContent??"";V({name:c,position:r,phone:s})}st(t)}});var ct=t=>t.key==="Escape";var i=document.querySelector(Z),at=document.querySelector(G);function lt(t){i.showModal(),at.style.overflow="hidden";let o=i.querySelector(X);o.innerHTML="";let e=t.content.cloneNode(!0);o.appendChild(e),i.querySelector("input").focus(),document.addEventListener("keydown",v)}function B(){i.close(),at.style.overflow="auto",document.removeEventListener("keydown",v)}function v(t){ct(t)&&(t.preventDefault(),B())}var it=t=>{let o="";t.addEventListener("input",()=>{let e=t.value.replace(/\D/g,"");if(e.length<o.length){o=e;return}e.length===1&&e[0]!=="7"&&(e=`7${e}`);let n="+7 ";e.length>1&&(n+=e.substring(1,4)),e.length>4&&(n+=` ${e.substring(4,7)}`),e.length>7&&(n+=` ${e.substring(7,9)}`),e.length>9&&(n+=` ${e.substring(9,11)}`),t.value=n,o=e})};var Et=3,mt="input--error";function Lt(t,o){t.forEach(e=>{e.classList.remove(mt)}),o.textContent=""}function pt(t,o,e){t.classList.add(mt),o.textContent=e}function St(t){let o=[];return t.forEach(e=>{e.value.trim()||o.push({input:e,message:"Fill in all fields!"})}),o}function Ot(t,{name:o,position:e,phone:n}){return t.some(r=>r.name?.toLowerCase()===o.toLowerCase()&&r.position?.toLowerCase()===e.toLowerCase()&&r.phone===n)?[{input:null,message:"This contact has already been recorded!"}]:[]}function ut(t,o){let e=[],n=/^[a-zA-Z]+$/;return t.value.length<o&&e.push({input:t,message:`Value cannot be shorter than ${o} letters!`}),n.test(t.value)||e.push({input:t,message:"Value must contain English letters!"}),e}function Mt(t){return/^\+7 \d{3} \d{3} \d{2} \d{2}$/.test(t.value)?[]:[{input:t,message:"Wrong number!"}]}function Tt({inputs:t,storage:o,errorMessage:e}){let[n,c,r]=t;Lt(t,e);let s=St(t);if(s.length>0)return{isValid:!1,errors:s};let a={name:n.value,position:c.value,phone:r.value},l=Ot(o,a);if(l.length>0)return{isValid:!1,errors:l};let L=ut(n,Et);if(L.length>0)return{isValid:!1,errors:L};let p=ut(c,Et);if(p.length>0)return{isValid:!1,errors:p};let E=Mt(r);return E.length>0?{isValid:!1,errors:E}:{isValid:!0,errors:[]}}var Ct=document.querySelector(Y),S,O,m,u=null;function V(t){Ct&&lt(Ct);let o=i.querySelector(Q);o&&(o.textContent="Edit contact"),u=t,S=i.querySelector(j),O=i.querySelector(J),m=i.querySelector(W),S&&O&&m&&(S.value=t.name,O.value=t.position,m.value=t.phone),i.querySelector("input").focus(),document.addEventListener("keydown",v)}function jt(){let t=S?.value.trim()??"",o=O?.value.trim()??"",e=m?.value??"";if(!u)return;let n=u.name,c=u.position,r=u.phone;if(!S||!O||!m)return;let s=[S,O,m],a=document.querySelector(z);m&&it(m);let l=A(),{isValid:L,errors:p}=Tt({inputs:s,storage:l,errorMessage:a});if(!L){p.forEach(({input:I,message:g})=>{I?pt(I,a,g):a.textContent=g});return}let E={name:n,position:c,phone:r},M={name:t,position:o,phone:e};if(ot(E,M),rt(E,M),B(),u){let I=document.querySelector(`[data-id="${u.name[0].toUpperCase()}"]`)?.querySelector(T);if(I){let g=I.querySelector(h);g&&g.focus()}}u=null}export{V as openEditPopup,jt as saveEditPopup};
