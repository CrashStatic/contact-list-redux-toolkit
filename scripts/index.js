var rt=3,ct="input--error";function Jt(t,o){t.forEach(e=>{e.classList.remove(ct)}),o.textContent=""}function w(t,o,e){t.classList.add(ct),o.textContent=e}function zt(t){let o=[];return t.forEach(e=>{e.value.trim()||o.push({input:e,message:"Fill in all fields!"})}),o}function Qt(t,{name:o,position:e,phone:n}){return t.some(r=>r.name?.toLowerCase()===o.toLowerCase()&&r.position?.toLowerCase()===e.toLowerCase()&&r.phone===n)?[{input:null,message:"This contact has already been recorded!"}]:[]}function st(t,o){let e=[],n=/^[a-zA-Z]+$/;return t.value.length<o&&e.push({input:t,message:`Value cannot be shorter than ${o} letters!`}),n.test(t.value)||e.push({input:t,message:"Value must contain English letters!"}),e}function Xt(t){return/^\+7 \d{3} \d{3} \d{2} \d{2}$/.test(t.value)?[]:[{input:t,message:"Wrong number!"}]}function B({inputs:t,storage:o,errorMessage:e}){let[n,s,r]=t;Jt(t,e);let c=zt(t);if(c.length>0)return{isValid:!1,errors:c};let a={name:n.value,position:s.value,phone:r.value},i=Qt(o,a);if(i.length>0)return{isValid:!1,errors:i};let p=st(n,rt);if(p.length>0)return{isValid:!1,errors:p};let _=st(s,rt);if(_.length>0)return{isValid:!1,errors:_};let m=Xt(r);return m.length>0?{isValid:!1,errors:m}:{isValid:!0,errors:[]}}var at=".body",j="#letter",lt="#message",it="#search-modal-content",b=".element",W="element--active",Et=".element__letter",h=".element__contacts",Z="element__contacts--open",U=".element__counter",J="element__counter--active",mt=".element__message",T=".column__element",d=".message",C=".message__name",f=".message__position",L=".message__phone",z=".contact-table",R=".js-delete-contact-button",I=".js-edit-contact-button",ut=".js-clear-contact-button",pt=".js-search-contact-button",Tt="#edit-popup-content",dt="#popup-name",Ct="#popup-position",ft="#popup-phone",Lt=".popup__error",_t=".modal",St=".modal__title",Mt=".modal__body",Ot=".modal__input",Q=".modal__search-area",V=".modal__button-show",It=".modal__close-button",ht=".modal__overlay",At=".form",gt="name",Nt="position",yt="phone",Ht=".form__error",Rt=".form__buttons",xt=".form__button--popup-save";var A=class{constructor(o,e){this.counterElement=o,this.contactsContainer=e,this.count=0}increase(){this.count++,this.update()}decrease(){this.count>0&&(this.count--,this.update())}reset(){this.count=0,this.update()}update(){let o=this.contactsContainer.parentElement;o&&(this.count>0?(this.counterElement.classList.add(J),o.classList.add(W)):(this.counterElement.classList.remove(J),o.classList.remove(W))),this.counterElement.textContent=this.count.toString()}};function vt(t){if(localStorage.getItem(t))try{let e=localStorage.getItem(t);return e?JSON.parse(e):[]}catch(e){throw console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage:",e),new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage")}return[]}function x(t,o){localStorage.setItem(t,JSON.stringify(o))}var v="contacts",E=vt(v);function u(){return E}function Pt({name:t,position:o,phone:e}){let n={name:t,position:o,phone:e};E.push(n),x(v,E)}function qt({name:t,position:o,phone:e}){E=E.filter(n=>n.name!==t||n.position!==o||n.phone!==e),x(v,E)}function Dt(t){return E.filter(({name:o,position:e,phone:n})=>o.toLowerCase().includes(t.toLowerCase())||e.toLowerCase().includes(t.toLowerCase())||n.includes(t))}function wt(t,o){E=E.map(e=>e.name===t.name&&e.position===t.position&&e.phone===t.phone?o:e),x(v,E)}function Bt(){E=[],x(v,E)}var bt=t=>t.key==="Escape";var l=document.querySelector(_t),Ut=document.querySelector(at);function F(t){l.showModal(),Ut.style.overflow="hidden";let o=l.querySelector(Mt);o.innerHTML="";let e=t.content.cloneNode(!0);o.appendChild(e),l.querySelector("input").focus(),document.addEventListener("keydown",G)}function P(){l.close(),Ut.style.overflow="auto",document.removeEventListener("keydown",G)}function G(t){bt(t)&&(t.preventDefault(),P())}var $=t=>{let o="";t.addEventListener("input",()=>{let e=t.value.replace(/\D/g,"");if(e.length<o.length){o=e;return}e.length===1&&e[0]!=="7"&&(e=`7${e}`);let n="+7 ";e.length>1&&(n+=e.substring(1,4)),e.length>4&&(n+=` ${e.substring(4,7)}`),e.length>7&&(n+=` ${e.substring(7,9)}`),e.length>9&&(n+=` ${e.substring(9,11)}`),t.value=n,o=e})};var Vt=document.querySelector(Tt),g,N,O,M=null;function q(t){Vt&&F(Vt);let o=l.querySelector(St);o&&(o.textContent="Edit contact"),M=t,g=l.querySelector(dt),N=l.querySelector(Ct),O=l.querySelector(ft),g&&N&&O&&(g.value=t.name,N.value=t.position,O.value=t.phone),l.querySelector("input").focus(),document.addEventListener("keydown",G)}function Ft(){let t=g?.value.trim()??"",o=N?.value.trim()??"",e=O?.value??"";if(!M)return;let n=M.name,s=M.position,r=M.phone;if(!g||!N||!O)return;let c=[g,N,O],a=document.querySelector(Lt);O&&$(O);let i=u(),{isValid:p,errors:_}=B({inputs:c,storage:i,errorMessage:a});if(!p){_.forEach(({input:y,message:H})=>{y?w(y,a,H):a.textContent=H});return}let m={name:n,position:s,phone:r},S={name:t,position:o,phone:e};if(wt(m,S),Gt(m,S),P(),M){let y=document.querySelector(`[data-id="${M.name[0].toUpperCase()}"]`)?.querySelector(d);if(y){let H=y.querySelector(I);H&&H.focus()}}M=null}var k={};function X({name:t,position:o,phone:e}){let r=document.querySelector(lt).content.querySelector(d)?.cloneNode(!0);if(!r)return;let c=r.querySelector(C),a=r.querySelector(f),i=r.querySelector(L);return!c||!a||!i?null:(c.textContent=t,a.textContent=o,i.textContent=e,r)}function te(t,o){o.innerHTML="",t.forEach(({name:e,position:n,phone:s})=>{let r=X({name:e,position:n,phone:s});r&&o.append(r)})}function $t(t,o){let e=document.querySelector(`[data-id="${t.toLowerCase()}"]`)?.closest(T);if(e){let n=e.querySelector(h);te(o,n);let s=e.querySelector(U);k[t]||(k[t]=new A(s,n)),k[t].count=o.length,k[t].update()}}function K({contact:t,letterElement:o,shouldSave:e=!0}){e&&Pt(t);let n=o.querySelector("[data-id]")?.textContent?.toUpperCase()??"",s=u().filter(r=>r.name[0].toUpperCase()===n);$t(n,s)}function Y(t){let e=t.target.closest(d);if(!e)return;let n=e.querySelector(C)?.textContent??"",s=e.querySelector(f)?.textContent??"",r=e.querySelector(L)?.textContent??"";qt({name:n,position:s,phone:r}),e.remove();let c=n[0].toUpperCase(),a=u().filter(i=>i.name[0].toUpperCase()===c);$t(c,a)}function Gt(t,o){let e=t.name[0].toUpperCase(),n=document.querySelector(`[data-id="${e.toLowerCase()}"]`)?.closest(T);n&&n.querySelector(h).querySelectorAll(mt).forEach(c=>{let a=c.querySelector(C)?.textContent??"",i=c.querySelector(f)?.textContent??"",p=c.querySelector(L)?.textContent??"";if(a===t.name&&i===t.position&&p===t.phone){let _=c.querySelector(C),m=c.querySelector(f),S=c.querySelector(L);_&&m&&S&&(_.textContent=o.name,m.textContent=o.position,S.textContent=o.phone)}})}function kt(t){let o=t.target;if(o.closest(T)){let e=o.closest(b);if(!e)return;let n=e.querySelector(h);if(!n)return;n.classList.toggle(Z),n.classList.contains(Z)?n.style.maxHeight=`${n.scrollHeight}px`:n.style.maxHeight="0"}}document.querySelector(z)?.addEventListener("click",t=>{let o=t.target;if(o.closest(R)){Y(t);return}if(o.closest(I)){let e=o.closest(d),n=e.querySelector(C)?.textContent??"",s=e.querySelector(f)?.textContent??"",r=e.querySelector(L)?.textContent??"";q({name:n,position:s,phone:r})}kt(t)});document.querySelector(z)?.addEventListener("keydown",t=>{let o=t;if(o.key===" "||o.key==="Enter"){t.preventDefault();let e=t.target;if(e.matches(R)){Y(t);return}if(e.closest(I)){let n=e.closest(d),s=n.querySelector(C)?.textContent??"",r=n.querySelector(f)?.textContent??"",c=n.querySelector(L)?.textContent??"";q({name:s,position:r,phone:c})}kt(t)}});var ee=document.querySelector(it);function Kt(t,o){if(o.innerHTML="",t.length===0){o.textContent="No results found";return}t.forEach(({name:e,position:n,phone:s})=>{let r=X({name:e,position:n,phone:s});r&&o.appendChild(r)})}function oe(t,o){t.addEventListener("input",()=>{let e=t.value.trim().toLowerCase();if(e){let n=Dt(e);Kt(n,o)}else o.innerHTML=""})}function Yt(){F(ee);let t=l.querySelector(Ot),o=l.querySelector(Q);oe(t,o),l.querySelector(V).addEventListener("click",tt)}function tt(){let t=u(),o=l.querySelector(Q);Kt(t,o),l.querySelector("input").focus()}var et=document.getElementById(gt),ot=document.getElementById(Nt),D=document.getElementById(yt);function ne(){let t=et.value.trim(),o=ot.value.trim(),e=D.value.trim(),n=document.querySelector(Ht),s=[et,ot,D],r=u(),{isValid:c,errors:a}=B({inputs:s,storage:r,errorMessage:n});if(!c){a.forEach(({input:m,message:S})=>{m?w(m,n,S):n.textContent=S});return}let i=t[0].toUpperCase(),p=document.querySelector(`[data-id="${i.toLowerCase()}"]`)?.closest(T);K({contact:{name:t,position:o,phone:e},letterElement:p}),et.value="",ot.value="",D.value=""}function re(){document.querySelectorAll(T).forEach(t=>{let o=t.querySelector(h);o.innerHTML="";let e=t.querySelector(U);new A(e,o).reset()}),Bt()}var se=document.querySelector(At);se.addEventListener("submit",t=>{t.preventDefault(),ne()});var ce=document.querySelector(Rt);ce.addEventListener("click",t=>{let o=t.target;o.matches(ut)&&re(),o.matches(pt)&&Yt()});var jt=document.querySelector(j);if(!jt)throw new Error(`Template with selector ${j} not found.`);var ae=jt.content.querySelector(b),le=({letter:t,id:o})=>{let e=ae?.cloneNode(!0);if(e){let n=e.querySelector(Et);n.textContent=t,n.dataset.id=o,e.setAttribute("tabindex","0")}return e},nt=(t,o)=>{let e=document.createDocumentFragment();t.forEach(n=>{let s=le(n);e.append(s)}),o.append(e)};var Wt=[{letter:"A",id:"a"},{letter:"B",id:"b"},{letter:"C",id:"c"},{letter:"D",id:"d"},{letter:"E",id:"e"},{letter:"F",id:"f"},{letter:"G",id:"g"},{letter:"H",id:"h"},{letter:"I",id:"i"},{letter:"J",id:"j"},{letter:"K",id:"k"},{letter:"L",id:"l"},{letter:"M",id:"m"}],Zt=[{letter:"N",id:"n"},{letter:"O",id:"o"},{letter:"P",id:"p"},{letter:"Q",id:"q"},{letter:"R",id:"r"},{letter:"S",id:"s"},{letter:"T",id:"t"},{letter:"U",id:"u"},{letter:"V",id:"v"},{letter:"W",id:"w"},{letter:"X",id:"x"},{letter:"Y",id:"y"},{letter:"Z",id:"z"}];document.addEventListener("DOMContentLoaded",()=>{let t=document.querySelector(".column-left"),o=document.querySelector(".column-right");nt(Wt,t),nt(Zt,o),u().forEach(({name:n,position:s,phone:r})=>{let c=n[0].toUpperCase(),a=document.querySelector(`[data-id="${c.toLowerCase()}"]`)?.closest(T);a&&K({contact:{name:n,position:s,phone:r},letterElement:a,shouldSave:!1})}),$(D),l.addEventListener("click",n=>{let s=n.target;if(s.matches(V)&&tt(),s.matches(xt)&&Ft(),s.closest(R)){Y(n);return}if(s.closest(I)){let r=s.closest(d),c=r.querySelector(C)?.textContent??"",a=r.querySelector(f)?.textContent??"",i=r.querySelector(L)?.textContent??"";q({name:c,position:a,phone:i})}(s.closest(It)||s.matches(ht))&&P()})});
